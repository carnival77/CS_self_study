# 가상기억장치 구현 기법

- [가상기억장치 구현 기법](#가상기억장치-구현-기법)
  - [개념](#개념)
    - [페이징 기법](#페이징-기법)
      - [페이징 기법 작동 예시](#페이징-기법-작동-예시)
      - [페이징 기법의 장단점](#페이징-기법의-장단점)
    - [세그먼테이션 기법](#세그먼테이션-기법)
      - [세그먼테이션 작동 예시](#세그먼테이션-작동-예시)
      - [세그먼테이션 기법의 장단점](#세그먼테이션-기법의-장단점)
      - [주소 변환](#주소-변환)
      - [논리 주소와 물리 주소](#논리-주소와-물리-주소)


## 개념

> 보조기억장치의 일부를 주기억장치처럼 사용하는 것. 용량이 작은 주기억장치를 마치 큰 용량을 가진 것처럼 사용하는 기법

### 페이징 기법

> 가상기억장치에 보관되어 있는 **프로그램과 주기억장치의 영역을 동일한 크기로 나눈 후** 나눠진 프로그램을 동일하게 나눠진 **주기억장치의 영역에 적재시켜 실행**하는 기법

- 나눠진 **물리 메모리**는 고정 크기의 **Frame** 이라는 블럭 단위로 분리되며, **논리 메모리**(프로세스가 점유하는)는 **페이지**라 불리는 고정 크기의 블록으로 분리된다.
- **운영체제**는 프로세스의 메모리 접근을 관리하기 위해 **프레임을 직접적으로 사용하지 않고 페이지라는 논리적인 블럭을 사용**
- 프레임과 페이지의 단위 크기는 같아야 함

- 페이지(Page) : 프로그램을 일정한 크기로 나눈 단위
- 페이지 프레임(Page Frame) : 페이지 크기로 일정하게 나눈 주기억장치의 단위
- 페이지 맵 테이블 : **주소 변환**을 위한 페이지의 위치 정보를 저장
  - 페이지는 페이지 테이블을 통해 자신이 어느 프레임을 가르키고 있는지 알아낼 수 있습니다.
  - ![img](https://file.notion.so/f/f/f5400709-096e-4d74-a173-23c265e25a37/38219b49-6a3d-4b02-973c-bca6a55f7947/Untitled.png?id=5444033f-8647-46ed-8aab-f4880ab10584&table=block&spaceId=f5400709-096e-4d74-a173-23c265e25a37&expirationTimestamp=1719122400000&signature=lMU4e9y-f2W2w4wfmJ06JkAWDVVGWeTPHsLPAmNY8Pg&downloadName=Untitled.png)
- 페이지 맵 테이블 사용 -> 비용이 증가, 처리 속도 감소

#### 페이징 기법 작동 예시

![img](https://file.notion.so/f/f/f5400709-096e-4d74-a173-23c265e25a37/f2c6ce96-ed06-434b-9561-2963b685b5de/Untitled.png?id=c3b8dd3f-c9b2-4093-ab91-d0d952afa377&table=block&spaceId=f5400709-096e-4d74-a173-23c265e25a37&expirationTimestamp=1719122400000&signature=RBFJ_Q5mIqVlgWZiJ7-hAsuxRqdQ_32kC5w7-RFUXUU&downloadName=Untitled.png)

위 그림과 같이 프로세스 P1은 5개의 페이지로 나눌 수 있다. 이를 메인 메모리 5곳에 나눠서 할당하였다. 프로세스를 정상적으로 사용하기 위해 CPU는 논리 주소로 프로그램이 설정한대로 연속적인 주소값으로 명령을 내리고, 이를 위해 **메모리로 가기전에 각 페이지의 실제 메모리 주소가 저장되어 있는 페이지 테이블**에서, **MMU의 재배치 레지스터**를 여러개 사용해서 위의 그림과 같이 **각 페이지의 실제 물리 주소로 변경**되어야 한다.

#### 페이징 기법의 장단점

1. 외부 단편화 발생 X
   1. 페이징 기법을 사용함으로써 하나의 프로세스가 사용하는 공간은 여러개의 페이지로 나뉘어서 논리 메모리에서 관리되고 개별 페이지는 순서에 상관없이 물리 메모리에 있는 남는 프레임에 적절히 mapping 되어 저장된다.
2. 내부 단편화 발생 O
   1. 예를 들어 페이지 크기가 1,024B 이고 프로세스 A 가 3,172B 의 메모리를 요구한다면 3 개의 페이지 프레임(1,024 * 3 = 3,072) 하고도 100B 가 남기때문에 총 4 개의 페이지 프레임이 필요한 것이다. 결론적으로 4 번째 페이지 프레임에는 924B(1,024 - 100)의 여유 공간이 남게 되는 내부 단편화 문제가 발생하는 것이다.

### 세그먼테이션 기법

> 가상기억장치에 보관되어 있는 프로그램을 다양한 크기의 논리적 단위로 나눈 후 주기억장치에 적재시켜 실행하는 방법

- 세그먼트 : 프로그램을 배열이나 함수 등 논리적인 크기로 나눈 단위
- 각 세그먼트는 고유한 이름과 크기를 갖는다.
- 사용 목적 : 기억공간 절약 
- 세그먼트 맵 테이블 : **주소 변환**을 위해서 세그먼트가 존재하는 위치 정보를 저장

#### 세그먼테이션 작동 예시

![img](https://file.notion.so/f/f/f5400709-096e-4d74-a173-23c265e25a37/6518e68c-585d-4f2d-b839-08cf8f1696b5/Untitled.png?id=fd6dd4cc-ee81-4725-93bc-d5f1d49bc7fd&table=block&spaceId=f5400709-096e-4d74-a173-23c265e25a37&expirationTimestamp=1719115200000&signature=S6QRF4pfSjk1CYhNJftiSFT9oiTCyDda17e3uH-Kstw&downloadName=Untitled.png)

세그먼트 테이블에는 각 세그먼트 번호와, 세그먼트의 기준(세그먼트의 시작 물리 주소 : base)과 한계(세그먼트의 길이 : limit)를 저장하여 엔트리로 갖는다.

page size가 동일하지 않기 때문에, frame 번호로 논리 주소와 물리 주소를 연결할 수 없다. 그래서 대신 table이 bound를 가지고 있어야 한다. 페이징과 마찬가지로 논리 주소의 규약을 가지며, 이번에는 p가 아니고 s로 표기한다.

![Untitled](https://file.notion.so/f/f/f5400709-096e-4d74-a173-23c265e25a37/2842e67c-42b6-40e4-a062-8b405b6b076f/Untitled.png?id=40656d49-a8f0-4c53-b8e2-1626a5667e72&table=block&spaceId=f5400709-096e-4d74-a173-23c265e25a37&expirationTimestamp=1719122400000&signature=vBdNXqNzgBbyX9Ciy0JPRCE4AIPFU--9NtivRFyS1oQ&downloadName=Untitled.png)

한 가지 주의할 점은 세그먼트의 크기는 일정하지 않기 때문에, 테이블에 limit 정보가 주어진다. 그리고 CPU에서 해당 세그먼트의 크기를 넘어서는 주소가 들어오면 인터럽트가 발생해서 해당 프로세스를 강제로 종료시킨다.

#### 세그먼테이션 기법의 장단점

1. 외부 단편화 발생 O
   1. 세그먼테이션은 논리적인 단위로 나누기 때문에 세그먼트의 크기가 다양하다. 이로 인해 다양한 크기의 hole이 발생
2. 내부 단편화는 발생 X

[Segmentation](https://www.notion.so/Segmentation-622690cae3754ac1b31a6cadc4e74d28)


#### 주소 변환

가상기억장치에 있는 프로그램이 주기억장치에 적재되어 실행될 때 **논리적인 가상주소**를 **물리적인 실기억주소**로 변환하는 것으로, **주소 사상** 또는 **주소 매핑**이라고 한다. 이때 연속적인 가상 주소가 반드시 연속적인 실기억주소로 변환되지 않아도 되며, 이를 **인위적 연속성**이라고 한다.

#### 논리 주소와 물리 주소

- CPU가 취급하는 주소를 `논리주소`, 해당 논리주소에 연관된 실제 메모리의 주소를 `물리주소`라고 합니다.
- 프로그램이 논리주소를 통해 데이터를 요청하면, 운영체제는 해당 논리주소를 물리주소로 변환해야 하며, 이러한 역할을 수행하는 장치를 `MMU`(`Memory Managemnt nit`)이라고 합니다.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/18cefca5-3543-4031-8516-8177b3ec64f6/Untitled.png)