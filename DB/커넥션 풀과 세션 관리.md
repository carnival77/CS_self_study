# 커넥션 풀과 세션 관리

## **커넥션 풀과 세션 관리의 관계**

**커넥션 풀**: 데이터베이스 연결을 재사용하여 성능을 최적화.

**세션 관리**: 연결 상태를 유지하고 트랜잭션을 관리하여 데이터의 무결성 보장.

- **커넥션 풀**은 **커넥션**(즉, 데이터베이스와의 연결)을 재사용하는 구조를 제공하여 성능을 최적화합니다.
- **세션 관리**는 **해당 연결을 사용하는 동안의 상태**를 관리하고 트랜잭션의 일관성을 유지합니다.
- 이 둘은 서로 보완적입니다. **커넥션 풀**이 없으면 매번 새로운 연결을 생성해야 하므로 효율이 떨어지고, **세션 관리**가 없다면 데이터의 무결성을 보장하기 어렵습니다. 커넥션 풀을 통해 빠르게 연결을 확보하고, 세션 관리를 통해 안전하게 데이터 작업을 수행하는 것이 일반적인 방식입니다.

## **1. 커넥션 풀 (Connection Pool)**

### **개념**

- **커넥션 풀**은 데이터베이스와의 연결(커넥션)을 미리 여러 개 만들어 두고 필요할 때 가져다 쓰는 저장소입니다. 프로그램이 시작될 때 일정 수의 연결을 생성하여 풀에 보관합니다.

### **장점**

- **연결 생성 비용 절감 및 성능 향상**: 데이터베이스에 연결을 생성하고 끊는 작업은 시간이 많이 걸립니다. 매번 연결을 새로 만드는 대신, 이미 만들어진 연결을 재사용하면 응답 속도가 빨라집니다.
- **자원 관리**: 데이터베이스는 동시에 처리할 수 있는 연결 수에 제한이 있습니다. 커넥션 풀을 사용하면 필요한 만큼만 연결을 사용하고 반환하여 자원을 효율적으로 관리할 수 있습니다.

### **동작 방식**

1. **초기 설정**: 애플리케이션이 시작되면 미리 여러 개의 데이터베이스 연결을 만들어 커넥션 풀에 넣어 둡니다.
2. **요청 처리**:
   - 사용자가 데이터베이스 작업을 요청하면 커넥션 풀에서 미리 생성된 연결을 가져와 사용합니다.
   - 작업이 끝나면 연결을 닫는 것이 아니라 커넥션 풀에 반환합니다.
3. **연결 관리**:
   - 필요에 따라 연결의 수를 늘리거나 줄일 수 있습니다.
   - 오래된 연결이나 사용하지 않는 연결은 제거하여 자원을 절약합니다.

4. **비유**: 
   1. 커넥션 풀을 **다중이용 도서관의 열람실**로 비유할 수 있습니다. 열람실의 자리는 제한되어 있고, 사용자가 언제나 들어와서 책을 읽을 수 있게 자리를 배정해 줍니다. 자리를 차지하고 있는 동안 다른 사람은 사용할 수 없지만, 한 사람이 다 사용하면 바로 다음 사람이 사용할 수 있습니다. 열람실의 자리(연결 객체)를 재사용함으로써 열람실 전체의 효율성이 높아집니다.

5. **사용 예시**:
   - 웹 애플리케이션에서 사용자가 동시에 많이 접속할 경우, 데이터베이스와 연결을 효율적으로 관리해 트래픽 처리 능력을 높입니다.

---

### ## **2. 세션 관리 (Session Management)**

### **개념**

- **세션 관리**는 웹 애플리케이션에서 사용자의 상태나 정보를 일정 시간 동안 유지하기 위한 방법입니다.
- **데이터베이스와의 연결 기간 동안 유지되는 상태**를 관리하는 것입니다. 여기서 세션은 애플리케이션이 데이터베이스와 상호작용하는 특정 시점 동안 지속되는 **연결 상태**를 의미합니다.
- 웹은 기본적으로 상태를 유지하지 않는(stateless) 특성이 있어서, 사용자가 페이지를 이동할 때마다 정보를 잃어버립니다. 세션 관리를 통해 로그인 정보나 장바구니 같은 사용자별 데이터를 유지합니다.

### **사용 이유**

- **개인화된 서비스 제공**: 사용자가 로그인했는지, 이전에 어떤 행동을 했는지 등을 알아야 맞춤형 서비스를 제공할 수 있습니다.
- **상태 유지**: 페이지를 이동하거나 새로고침해도 사용자 정보를 잃지 않고 계속 사용할 수 있습니다.
- **트랜잭션 처리**: 여러 데이터베이스 작업을 하나의 논리적인 단위로 묶어 **성공 또는 실패**를 원자적으로 관리합니다. 예를 들어, 은행에서 돈을 송금하는 작업처럼 하나라도 실패하면 전체를 롤백해야 하는 경우 세션을 이용해 이를 관리합니다.
- **자원 해제**: 세션을 다 사용하고 나면 연결을 해제해 커넥션 풀로 돌려놓아야 합니다. 이를 통해 불필요한 데이터베이스 연결이 지속되지 않게 하여 서버 자원을 절약할 수 있습니다.

### 장점

1. **트랜잭션 일관성 유지**: 세션을 통해 여러 SQL 작업을 하나의 트랜잭션으로 묶어 일관성을 유지할 수 있습니다.
2. **에러 처리 용이**: 세션에서 문제가 발생하면 전체 작업을 롤백하여 데이터의 무결성을 보장할 수 있습니다.

### **동작 방식**

1. **세션 생성**:
   - 사용자가 웹사이트에 처음 접속하거나 로그인하면 서버는 **세션 ID**를 생성합니다.
   - 이 세션 ID는 고유한 값으로, 사용자를 식별하는 데 사용됩니다.
2. **세션 저장**:
   - 서버는 세션 ID와 함께 사용자 정보를 서버의 메모리나 데이터베이스에 저장합니다.
3. **세션 유지**:
   - 사용자의 브라우저는 쿠키나 URL에 세션 ID를 포함하여 서버에 요청을 보냅니다.
   - 서버는 세션 ID를 확인하고 해당 사용자의 정보를 가져옵니다.
4. **세션 종료**:
   - 사용자가 로그아웃하거나 일정 시간이 지나면 세션이 만료됩니다.
   - 서버는 해당 세션 정보를 삭제하여 자원을 해제합니다.

5. **비유**
   1. 세션 관리는 **은행에서 창구 업무를 처리하는 것**으로 비유할 수 있습니다. 고객(애플리케이션)이 창구(데이터베이스)에서 어떤 업무(쿼리)를 처리할 때, 처리하는 동안 창구는 그 고객과의 상호작용을 위해 예약된 상태가 됩니다. 모든 업무가 끝나면 창구는 다시 다음 고객을 받을 준비를 합니다. 여기서 창구가 업무를 진행하는 동안의 상태가 세션이라고 볼 수 있습니다.
6. **사용 예시**:
   - 쇼핑몰에서 사용자가 주문을 확정할 때, 재고 감소 및 결제 처리 등을 하나의 세션으로 묶어 관리해 **일관된 상태**로 완료되도록 합니다.

### **세션과 쿠키의 차이점**

- **세션**:
  - 서버 측에서 관리하는 사용자 정보 저장 방식입니다.
  - 보안성이 높습니다. (클라이언트에 민감한 정보가 저장되지 않음)
- **쿠키**:
  - 클라이언트(브라우저) 측에서 관리하는 작은 데이터 저장 공간입니다.
  - 보안에 취약할 수 있습니다. (클라이언트에 데이터가 저장되기 때문에 조작 가능)

------

### **정리**

- **커넥션 풀**은 데이터베이스 연결을 효율적으로 관리하여 애플리케이션의 성능을 높여줍니다.
- **세션 관리**는 웹 애플리케이션에서 사용자의 상태를 유지하여 개인화된 경험을 제공하고, 지속적인 상호작용을 가능하게 합니다.